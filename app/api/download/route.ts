import { NextRequest, NextResponse } from 'next/server'

// Sample content for different resources
const resourceContent = {
  'resume-translation-worksheet': {
    title: 'Resume Translation Worksheet',
    content: `MILITARY-TO-CIVILIAN RESUME TRANSLATION WORKSHEET

This worksheet will help you translate your military experience into civilian terms that resonate with hiring managers.

SECTION 1: LEADERSHIP & MANAGEMENT
Military Term → Civilian Translation
• Commanded → Directed, Led, Managed
• Squad/Platoon Leader → Team Lead, Department Supervisor
• Executive Officer → Deputy Director, Assistant Manager
• Operations Officer → Operations Manager
• First Sergeant → Senior Manager, HR Manager

SECTION 2: TECHNICAL SKILLS
Military Systems → Civilian Equivalent
• SIPR/NIPR → Classified/Unclassified Networks
• C4ISR → IT Infrastructure & Analytics
• Battle Rhythm → Business Operations Cycle
• OPSEC → Information Security
• Force Protection → Physical/Cyber Security

SECTION 3: ACCOMPLISHMENTS
Quantify Your Impact:
• Led team of ___ personnel
• Managed $____ in equipment/budget
• Improved efficiency by ____%
• Reduced costs by $____
• Completed ____ projects on time/under budget

SECTION 4: CERTIFICATIONS
Military Training → Civilian Certification
• Signal Officer Basic → IT Management
• Cyber Operations → Security+, CISSP
• Military Intelligence → Data Analytics
• Logistics → Supply Chain Management

WORKSHEET EXERCISE:
1. List your top 5 military roles:
   [Your Role] → [Civilian Equivalent]
   
2. Identify 3 major accomplishments:
   [Military Achievement] → [Business Impact]
   
3. Technical skills translation:
   [Military System] → [Civilian Technology]

TIPS FOR SUCCESS:
• Remove military jargon and acronyms
• Focus on results and metrics
• Emphasize leadership and problem-solving
• Highlight relevant technical skills
• Use action verbs (managed, developed, implemented)

Remember: Your military experience is valuable - it's all about presenting it in terms civilian employers understand.`
  },
  'interview-success-checklist': {
    title: 'Interview Success Checklist',
    content: `CLEARED IT PROFESSIONAL INTERVIEW SUCCESS CHECKLIST

BEFORE THE INTERVIEW (1 Week Prior)
□ Research the company and contract
□ Review job requirements and match to your skills
□ Prepare 5-7 STAR format stories
□ Update and print copies of resume
□ Verify clearance status and dates
□ Plan interview outfit (business professional)
□ Prepare questions to ask interviewer

CLEARANCE-SPECIFIC PREPARATION
□ Know your investigation dates (initial and periodic)
□ Be ready to discuss clearance level without revealing classified info
□ Prepare explanation for any clearance issues/gaps
□ Understand polygraph requirements if applicable
□ Know your FSO/security POC contact info

TECHNICAL PREPARATION
□ Review technical requirements in job posting
□ Practice explaining complex technical concepts simply
□ Prepare examples of troubleshooting/problem-solving
□ Be ready to discuss relevant certifications
□ Review current industry trends and technologies

DAY BEFORE INTERVIEW
□ Confirm interview time and location
□ Test video/audio if virtual interview
□ Review company website and recent news
□ Practice elevator pitch (60-second introduction)
□ Prepare folder with resumes, references, certifications
□ Get good night's sleep

DAY OF INTERVIEW
□ Arrive 15 minutes early (or log in 5 minutes early if virtual)
□ Bring notepad and pen
□ Turn off phone or put on silent
□ Bring water bottle
□ Review notes one final time

DURING THE INTERVIEW
□ Firm handshake and eye contact
□ Use interviewer's name
□ Provide specific examples
□ Ask clarifying questions when needed
□ Show enthusiasm for the role
□ Take notes on key points

QUESTIONS TO ASK
□ What does success look like in this role?
□ What are the biggest challenges?
□ What is the team structure?
□ What are the growth opportunities?
□ What is the contract duration?
□ What is the next step in the process?

CLOSING THE INTERVIEW
□ Summarize why you're a great fit
□ Express strong interest in the position
□ Ask about timeline for decision
□ Get business cards/contact info
□ Thank interviewer for their time

AFTER THE INTERVIEW
□ Send thank you email within 24 hours
□ Connect on LinkedIn if appropriate
□ Follow up if no response within stated timeframe
□ Continue job search until offer is signed
□ Document interview questions for future prep

RED FLAGS TO AVOID
× Don't discuss classified information
× Don't badmouth previous employers
× Don't lie about technical skills
× Don't discuss salary too early
× Don't appear desperate
× Don't forget to ask questions

VIRTUAL INTERVIEW TIPS
□ Test technology in advance
□ Ensure professional background
□ Good lighting (face the light source)
□ Minimize background noise
□ Maintain eye contact with camera
□ Have backup plan for tech issues

Remember: Confidence + Preparation = Success!`
  },
  'goal-workbook': {
    title: 'Goal Setting Workbook',
    content: `CLEARED CAREER GOAL SETTING WORKBOOK

YOUR 90-DAY ACTION PLAN

CURRENT SITUATION ASSESSMENT
1. Current Role: _______________________
2. Current Clearance Level: _____________
3. Years of Experience: ________________
4. Current Salary: ____________________
5. Location: _________________________

30-DAY GOALS (Immediate Actions)
□ Update resume with latest experience
□ Complete one new certification
□ Attend 2 networking events
□ Apply to 10 targeted positions
□ Schedule 3 informational interviews

Specific Goal #1: _____________________
Action Steps:
- Step 1: ___________________________
- Step 2: ___________________________
- Step 3: ___________________________
Due Date: ___________________________

60-DAY GOALS (Building Momentum)
□ Complete certification exam
□ Expand network by 20 connections
□ Achieve 5 interviews
□ Join professional organization
□ Develop elevator pitch

Specific Goal #2: _____________________
Action Steps:
- Step 1: ___________________________
- Step 2: ___________________________
- Step 3: ___________________________
Due Date: ___________________________

90-DAY GOALS (Major Milestones)
□ Receive at least 2 job offers
□ Negotiate salary increase of 15%+
□ Start new position or promotion
□ Establish mentor relationship
□ Create 6-month career plan

Specific Goal #3: _____________________
Action Steps:
- Step 1: ___________________________
- Step 2: ___________________________
- Step 3: ___________________________
Due Date: ___________________________

SKILL DEVELOPMENT PLAN
Technical Skills to Acquire:
1. ________________________________
2. ________________________________
3. ________________________________

Soft Skills to Improve:
1. ________________________________
2. ________________________________
3. ________________________________

Certifications to Pursue:
1. ________________________________
2. ________________________________
3. ________________________________

NETWORKING STRATEGY
Target Companies:
1. ________________________________
2. ________________________________
3. ________________________________
4. ________________________________
5. ________________________________

Key Contacts to Make:
1. Name: _________ Company: _________
2. Name: _________ Company: _________
3. Name: _________ Company: _________

Events to Attend:
1. Event: ________ Date: ____________
2. Event: ________ Date: ____________
3. Event: ________ Date: ____________

ACCOUNTABILITY MEASURES
Weekly Check-in Day: _________________
Accountability Partner: ______________
Progress Tracking Method: ____________

SUCCESS METRICS
□ Number of applications sent: ________
□ Response rate: ____________________
□ Interview conversion rate: _________
□ Salary increase achieved: __________
□ New skills acquired: _______________

OBSTACLES & SOLUTIONS
Potential Obstacle 1: ________________
Solution: ___________________________

Potential Obstacle 2: ________________
Solution: ___________________________

Potential Obstacle 3: ________________
Solution: ___________________________

MOTIVATION & REWARDS
Why This Matters to Me:
____________________________________
____________________________________

Reward for 30-Day Success: ___________
Reward for 60-Day Success: ___________
Reward for 90-Day Success: ___________

NOTES & REFLECTIONS
____________________________________
____________________________________
____________________________________
____________________________________

Remember: Small consistent actions lead to big results!`
  }
}

function generatePDF(title: string, content: string): string {
  // Simple PDF structure (this is a basic text representation)
  // In production, you'd use a library like jsPDF or PDFKit
  return `%PDF-1.4
1 0 obj
<< /Type /Catalog /Pages 2 0 R >>
endobj
2 0 obj
<< /Type /Pages /Kids [3 0 R] /Count 1 >>
endobj
3 0 obj
<< /Type /Page /Parent 2 0 R /Resources << /Font << /F1 << /Type /Font /Subtype /Type1 /BaseFont /Helvetica >> >> >> /MediaBox [0 0 612 792] /Contents 4 0 R >>
endobj
4 0 obj
<< /Length ${content.length + 100} >>
stream
BT
/F1 12 Tf
50 750 Td
(${title}) Tj
0 -20 Td
${content.split('\n').map(line => `(${line}) Tj\n0 -15 Td`).join('\n')}
ET
endstream
endobj
xref
0 5
0000000000 65535 f
0000000009 00000 n
0000000058 00000 n
0000000115 00000 n
0000000274 00000 n
trailer
<< /Size 5 /Root 1 0 R >>
startxref
${content.length + 400}
%%EOF`
}

function generateDOCX(title: string, content: string): string {
  // Simplified DOCX structure (XML)
  return `<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<w:document xmlns:w="http://schemas.openxmlformats.org/wordprocessingml/2006/main">
  <w:body>
    <w:p>
      <w:pPr>
        <w:pStyle w:val="Title"/>
      </w:pPr>
      <w:r>
        <w:t>${title}</w:t>
      </w:r>
    </w:p>
    ${content.split('\n').map(line => `
    <w:p>
      <w:r>
        <w:t>${line}</w:t>
      </w:r>
    </w:p>`).join('')}
  </w:body>
</w:document>`
}

function generateRTF(title: string, content: string): string {
  // RTF format (compatible with Mac and Windows)
  const rtfContent = content
    .replace(/\n/g, '\\par ')
    .replace(/[^\x00-\x7F]/g, '') // Remove non-ASCII characters for compatibility
    
  return `{\\rtf1\\ansi\\deff0 {\\fonttbl {\\f0 Times New Roman;}}
{\\colortbl;\\red0\\green0\\blue0;}
\\f0\\fs24
{\\b ${title}}\\par
\\par
${rtfContent}
}`
}

export async function GET(request: NextRequest) {
  const searchParams = request.nextUrl.searchParams
  const resourceId = searchParams.get('id') || 'resume-translation-worksheet'
  const format = searchParams.get('format') || 'pdf'
  
  // Get the resource content
  const resource = resourceContent[resourceId as keyof typeof resourceContent] || {
    title: 'Resource Document',
    content: 'This is a sample resource document.'
  }
  
  let fileContent: string
  let mimeType: string
  let extension: string
  
  // Generate content based on format
  switch (format) {
    case 'pdf':
      fileContent = generatePDF(resource.title, resource.content)
      mimeType = 'application/pdf'
      extension = 'pdf'
      break
      
    case 'docx':
      fileContent = generateDOCX(resource.title, resource.content)
      mimeType = 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'
      extension = 'docx'
      break
      
    case 'rtf':
      fileContent = generateRTF(resource.title, resource.content)
      mimeType = 'application/rtf'
      extension = 'rtf'
      break
      
    case 'txt':
    default:
      fileContent = `${resource.title}\n${'='.repeat(resource.title.length)}\n\n${resource.content}`
      mimeType = 'text/plain'
      extension = 'txt'
      break
  }
  
  // Create filename
  const filename = `${resourceId}-${Date.now()}.${extension}`
  
  // Return the file
  return new NextResponse(fileContent, {
    headers: {
      'Content-Type': mimeType,
      'Content-Disposition': `attachment; filename="${filename}"`,
      'Cache-Control': 'no-cache',
    },
  })
}